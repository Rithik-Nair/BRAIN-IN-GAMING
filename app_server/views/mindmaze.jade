doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Mind Maze - Card Game
    style.
      /* General body styles */
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #f0f0f0;
        color: #000;
        margin: 0;
        padding: 20px;
      }

      /* Card styles */
      .card {
        width: 120px;
        height: 180px;
        border: 2px solid #000;
        background-color: #ccc; /* Back-facing color */
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease-in-out;
        display: inline-block;
        margin: 10px;
        position: relative;
      }

      .card:hover {
        transform: scale(1.05);
      }

      .card img {
        width: 100%;
        height: 100%;
        border-radius: 10px;
        display: none; /* Hide image initially */
        position: absolute;
        top: 0;
        left: 0;
      }

      /* Button container for back and start buttons */
      .button-container {
        margin-bottom: 20px;
      }

      button.back, button.start {
        color: #fff;
        background: #607d8b;
        border: none;
        border-radius: 8px;
        padding: 15px 25px;
        font-size: 18px;
        cursor: pointer;
        transition: background 0.3s ease;
        margin-right: 10px;
      }

      button.back:hover, button.start:hover {
        background: #3e4a52;
      }

      /* Grid layout for card deck */
      #card-deck {
        display: grid;
        grid-template-columns: repeat(4, 120px); /* 4 columns of cards */
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
      }

      /* Point meter styles */
      #point-meter {
        font-size: 24px;
        margin-bottom: 10px;
      }

      /* Feedback message styles */
      #feedback {
        font-size: 20px;
        color: #333;
        margin-bottom: 20px;
      }

      /* Chances meter styles */
      #chances-meter {
        font-size: 20px;
        margin-bottom: 10px;
      }

      /* Concentration meter styles */
      #concentration-meter-container {
        margin-top: 20px;
      }

      #concentration-label {
        font-size: 20px;
        margin-bottom: 5px;
      }

      #concentration-meter {
        width: 100%;
        height: 25px;
        background-color: #e0e0e0;
        border-radius: 15px;
        overflow: hidden;
        position: relative;
        border: 2px solid #000;
      }

      #concentration-bar {
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, #4caf50, #f44336);
        border-radius: 15px;
        transition: width 0.2s;
      }

      /* Modal styles */
      #game-over-modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        text-align: center;
      }

      #game-over-modal button {
        margin-top: 15px;
        background-color: #607d8b;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }

      #game-over-modal button:hover {
        background-color: #3e4a52;
      }

      /* Modal overlay */
      #modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }

  body
    h1 Mind Maze - Card Game
    #point-meter Points: 0
    #chances-meter Chances Left: 5
    #feedback
    #concentration-meter-container
      div#concentration-label Concentration Level:
      div#concentration-meter
        div#concentration-bar
    .button-container
      button.back(onclick="window.location.href='/'") Back to Home
      button.start(onclick="startGame()") Start Game
    div#card-deck
      // Empty at the start, will be populated by JavaScript

    // Modal structure for Game Over
    div#modal-overlay
    div#game-over-modal
      h2 Game Over!
      p Your score: <span id="final-score">0</span>
      button(onclick="resetGame()") Play Again

    script.
      const cards = [
        { name: 'Card 1', image: '/images/card1.jpg' },
        { name: 'Card 2', image: '/images/card2.jpg' },
        { name: 'Card 3', image: '/images/card3.jpg' },
        { name: 'Card 4', image: '/images/card4.jpg' },
        { name: 'Card 5', image: '/images/card5.jpg' },
        { name: 'Card 6', image: '/images/card6.jpg' },
        { name: 'Card 1', image: '/images/card1.jpg' },
        { name: 'Card 2', image: '/images/card2.jpg' },
        { name: 'Card 3', image: '/images/card3.jpg' },
        { name: 'Card 4', image: '/images/card4.jpg' },
        { name: 'Card 5', image: '/images/card5.jpg' },
        { name: 'Card 6', image: '/images/card6.jpg' }
      ];

      let flippedCards = [];
      let points = 0;
      let chances = 5;
      let concentration = 100; // Start concentration at 100%
      let concentrationInterval;
      let canFlip = true;

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      function startGame() {
        points = 0;
        chances = 5;
        concentration = 100;
        updatePoints();
        updateChances();
        updateFeedback('');
        updateConcentration();
        shuffle(cards);
        const cardDeck = document.getElementById('card-deck');
        cardDeck.innerHTML = '';
        cards.forEach((card, index) => {
          const cardElement = document.createElement('div');
          cardElement.classList.add('card');
          cardElement.setAttribute('data-index', index);
          const imgElement = document.createElement('img');
          imgElement.setAttribute('src', card.image);
          imgElement.setAttribute('alt', card.name);
          cardElement.appendChild(imgElement);
          cardElement.setAttribute('onclick', 'flipCard(this)');
          cardDeck.appendChild(cardElement);
        });
        clearInterval(concentrationInterval);
        concentrationInterval = setInterval(decreaseConcentration, 1000);
      }

      function decreaseConcentration() {
        if (concentration > 0) {
          concentration -= 2; // Decrease concentration over time
          updateConcentration();
        } else {
          clearInterval(concentrationInterval);
          gameOver();
        }
      }

      function updateConcentration() {
        const concentrationBar = document.getElementById('concentration-bar');
        concentrationBar.style.width = concentration + '%';
      }

      function flipCard(cardElement) {
        if (!canFlip || chances <= 0 || concentration <= 0) return;

        const imgElement = cardElement.querySelector('img');
        if (imgElement.style.display === 'block') return;

        imgElement.style.display = 'block';
        flippedCards.push({ cardElement, imgElement });

        if (flippedCards.length === 2) {
          canFlip = false;
          checkMatch();
        }
      }

      function checkMatch() {
        const [firstCard, secondCard] = flippedCards;

        if (firstCard.imgElement.src === secondCard.imgElement.src) {
          points++;
          updatePoints();
          updateFeedback('Correct!');
          flippedCards = [];
          canFlip = true;
        } else {
          updateFeedback('Wrong!');
          chances--;
          updateChances();
          setTimeout(() => {
            firstCard.imgElement.style.display = 'none';
            secondCard.imgElement.style.display = 'none';
            flippedCards = [];
            canFlip = true;
          }, 1000);
        }

        if (chances <= 0 || concentration <= 0) {
          gameOver();
        }
      }

      function updatePoints() {
        const pointMeter = document.getElementById('point-meter');
        pointMeter.textContent = 'Points: ' + points;
      }

      function updateChances() {
        const chancesMeter = document.getElementById('chances-meter');
        chancesMeter.textContent = 'Chances Left: ' + chances;
      }

      function updateFeedback(message) {
        const feedbackElement = document.getElementById('feedback');
        feedbackElement.textContent = message;
      }

      function gameOver() {
        clearInterval(concentrationInterval);
        updateFeedback('Game Over!');
        setTimeout(() => {
          document.getElementById('final-score').textContent = points;
          document.getElementById('game-over-modal').style.display = 'block';
          document.getElementById('modal-overlay').style.display = 'block';
        }, 1000);
      }

      function resetGame() {
        points = 0;
        chances = 5;
        concentration = 100;
        updatePoints();
        updateChances();
        updateFeedback('');
        updateConcentration();
        document.getElementById('game-over-modal').style.display = 'none';
        document.getElementById('modal-overlay').style.display = 'none';
        startGame();
      }
